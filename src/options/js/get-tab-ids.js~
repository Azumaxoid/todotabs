function getWindowId() {
  return new Promise(function(resolve, reject) {
    chrome.tabs.getCurrent(function(tab) {
alert("1");
      resolve(tab.windowId);
    });
  });
}

function getTabIds(windowId) {
  return new Promise(function(resolve, reject) {
alert("2");
    chrome.tabs.query({windowId: windowId},  resolve);
  });
}

(function() {
  getWindowId.then(getTabIds).then(function(res) { alert(res); });
})();
